<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="UserBase" >
  <resultMap id="BaseResultMap" type="java.util.HashMap" ></resultMap>
  <parameterMap id="BaseParameterMap" type="java.util.HashMap" ></parameterMap>
  
  
  
  <select id="getGradeSubjectParams" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
  		SELECT
			SC_SUBJECT_PK FK_SUBJECT,
			(SELECT FK_DICTIONARY_GRADE FROM SC_CLASS WHERE CLASS_PK = #{CLASS_PK})FK_DICTIONARY_GRADE
		FROM SC_SUBJECT
		WHERE 
		SUBJECT_NAME = (SELECT CASE WHEN LESSONCHNAME = '外语' THEN '英语' ELSE LESSONCHNAME END  FROM SC_LESSON WHERE PK_LESSONINFO_H = #{LESSON_PK})
  </select>
  <select id="getUserTeachClass" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
			SELECT
				*,
				CASE WHEN GRADE_YEAR_LEVEL = 1 THEN 'ef46950b07184a6e9fe8047f6a1a3a0d'
					 WHEN GRADE_YEAR_LEVEL = 2 THEN '39db23af3c4f4e43b5b4f04fcee8cb43'
				     WHEN GRADE_YEAR_LEVEL = 3 THEN 'd5517b8ff0a64f2cbdf979b9ec28fb73'
				END DICTIONARY_GRADE_FK,
				(SELECT GRADE_NAME FROM SC_DICTIONARY_GRADE WHERE GRADE_PK = FK_DICTIONARY_GRADE)GRADENAME,
				(SELECT SC_SUBJECT_PK FROM SC_SUBJECT WHERE SC_SUBJECT_PK IN (SELECT FK_SUBJECT FROM SC_GRADE_SUBJECT WHERE FK_DICTIONARY_GRADE = FK_GRADE) AND SUBJECT_NAME = LESSONNAME )FK_SUBJECT
			FROM
			(	SELECT 
				DISTINCT
				T2.CLASS_PK,
				(SELECT GRADE_YEAR_LEVEL FROM SC_GRADE WHERE GRADE_PK = T2.FK_GRADE)GRADE_YEAR_LEVEL,
				(SELECT GRADE_NAME FROM SC_GRADE WHERE GRADE_PK = T2.FK_GRADE)GRADE_NAME,
				T2.CLASS_BH,
				(SELECT CASE WHEN LESSONCHNAME = '外语' THEN '英语' ELSE LESSONCHNAME END FROM SC_LESSON WHERE PK_LESSONINFO_H = PK_LESSON)LESSONNAME,
				PK_LESSON,
				FK_GRADE,
				PK_CLASS,
				T2.CLASS_BJ,
				T2.FK_DICTIONARY_GRADE
			FROM SC_LESSON_TASK T1
			INNER JOIN SC_CLASS T2 ON T1.PK_CLASS = T2.CLASS_PK
			WHERE PK_USER = #{userInfo.GUID}
			AND T1.ACADEMID = (SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 1)
			AND T1.TERM = (SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 2)
			AND T1.DELETEFLAG = 0
			ORDER BY LESSONNUM DESC
)T3
  </select>
  <select id="getDistinctUserTeachClass" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
  		SELECT 
			DISTINCT
			T2.CLASS_PK,
			T2.CLASS_BH,
			FK_GRADE,
			T2.CLASS_BJ,
			(SELECT GRADE_YEAR_LEVEL FROM SC_GRADE WHERE GRADE_PK = T2.FK_GRADE)GRADE_YEAR_LEVEL,
			T2.FK_DICTIONARY_GRADE
		FROM SC_LESSON_TASK T1
		INNER JOIN SC_CLASS T2 ON T1.PK_CLASS = T2.CLASS_PK
		WHERE PK_USER = #{userInfo.GUID}
		AND T1.ACADEMID = (SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 1)
		AND T1.TERM = (SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 2)
		AND T1.DELETEFLAG = 0
		ORDER BY LESSONNUM DESC
  </select>
  <select id="getUserTeachLesson" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
		SELECT
		*,
		(SELECT SC_SUBJECT_PK FROM SC_SUBJECT WHERE SC_SUBJECT_PK IN (SELECT FK_SUBJECT FROM SC_GRADE_SUBJECT WHERE FK_DICTIONARY_GRADE = FK_GRADE) AND SUBJECT_NAME = LESSON_NAME )FK_SUBJECT
		FROM
		(	SELECT 
			DISTINCT
			T1.PK_LESSON,
			(SELECT LESSONCHNAME FROM SC_LESSON WHERE PK_LESSONINFO_H = T1.PK_LESSON)LESSON_NAME,
			T2.FK_DICTIONARY_GRADE
		FROM SC_LESSON_TASK T1
		INNER JOIN SC_CLASS T2 ON T1.PK_CLASS = T2.CLASS_PK
		WHERE PK_USER = #{userInfo.GUID}
		AND T1.ACADEMID = (SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 1)
		AND T1.TERM = (SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 2)
		AND T1.DELETEFLAG = 0
		AND T1.PK_CLASS = #{CLASS}
		ORDER BY LESSONNUM DESC
	)T3
  </select>
  <select id="getUserTeachInfo" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
  		SELECT
			USER_SN,
			USER_PK,
			(SELECT TEACHER_ZP FROM SC_USER_TEACHER WHERE TEACHER_PK = USER_PK)TEACHER_ZP,
			(SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 1) ACADEMID,
			(SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 2) TERM
		FROM SC_USER WHERE USER_PK = #{userInfo.GUID}
  </select>
  
  <select id="getClassStuList" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
  		SELECT
			STUDENT_PK,
			STUDENT_XH,
			STUDENT_XM,
			CASE WHEN STUDENT_XBM = '0000000SEX2010042716554109392196554' THEN 0 ELSE 1 END STUDENT_SEX,
			IFNULL(STUDENT_ZP,'NULL')STUDENT_ZP
		FROM SC_USER_STUDENT 
		WHERE STUDENT_BJID = #{CLASS_PK}
		ORDER BY STUDENT_XH ASC
  </select>
  <select id="getTreeRes" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
  		SELECT
  			G_ID,
			G_PID,
			G_ISLEAF,
			G_NODE_TEXT
  		FROM RES_SUBJECT_SORT WHERE G_PID = #{G_ID}
  		<if test="lessonName != null and lessonName != '' ">
			AND G_NODE_TEXT = #{lessonName}
		</if>
		ORDER BY ORDER_NUM ASC
  </select>
  <select id="getLessonNameByLessonPK" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
  		SELECT
  			LESSONCHNAME
  		FROM SC_LESSON 
  		WHERE PK_LESSONINFO_H = #{LESSON_PK}
  </select>
  <select id="getClassLevel" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
  		SELECT 
  			GRADE_YEAR_LEVEL 
  		FROM SC_GRADE 
  		WHERE GRADE_PK = (SELECT FK_GRADE FROM SC_CLASS WHERE CLASS_PK = #{CLASS_PK})
  </select>
  <select id="getTeacherGradeInfo" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
  		SELECT 
			DISTINCT
			PK_CLASS CLASS_PK,
		  (SELECT CLASS_BJ FROM SC_CLASS WHERE CLASS_PK = PK_CLASS)CLASS_NAME,
			(SELECT FK_GRADE FROM SC_CLASS WHERE CLASS_PK = PK_CLASS)FK_GRADE,
			(SELECT GRADE_NAME FROM SC_GRADE WHERE GRADE_PK = FK_GRADE)GRADE_NAME,
			(SELECT GRADE_YEAR_LEVEL FROM SC_GRADE WHERE GRADE_PK = FK_GRADE)GRADE_LEVEL
		FROM 
		SC_LESSON_TASK 
		WHERE ACADEMID = (SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 1)
		AND TERM = (SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 2)
		AND DELETEFLAG = 0
		AND PK_USER = #{USER_PK}
  		
  </select>
  <select id="getTeacherClassList" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
		SELECT 
			DISTINCT
			PK_CLASS CLASS_PK,
		    (SELECT CLASS_BJ FROM SC_CLASS WHERE CLASS_PK = PK_CLASS)CLASS_NAME,
            (SELECT GRADE_YEAR_LEVEL FROM SC_GRADE WHERE GRADE_PK = (SELECT FK_GRADE FROM SC_CLASS WHERE CLASS_PK = PK_CLASS))GRADE_YEAR_LEVEL
		FROM 
		SC_LESSON_TASK 
		WHERE ACADEMID = (SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 1)
		AND TERM = (SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 2)
		AND DELETEFLAG = 0
		AND PK_USER = #{USER_PK}
  </select>
  <select id="getTeacherLessonList" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
		SELECT 
			DISTINCT
			PK_LESSON,
			(SELECT LESSONCHNAME FROM SC_LESSON WHERE PK_LESSONINFO_H = PK_LESSON)LESSON_NAME
		FROM SC_LESSON_TASK WHERE
		ACADEMID = (SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 1)
		AND TERM = (SELECT PROP_VALUE FROM SC_PROP WHERE PROP_PK = 2)
		AND DELETEFLAG = 0
		AND PK_USER = #{USER_PK}
		AND PK_CLASS = #{CLASS_PK}
  </select>
  
 
  	
  
  
</mapper>